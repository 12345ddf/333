<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å•æœºæ–—åœ°ä¸»</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#1e88e5',
                        secondary: '#ff9800',
                        success: '#4caf50',
                        danger: '#f44336',
                        warning: '#ff9800',
                        info: '#2196f3',
                        light: '#f8f9fa',
                        dark: '#343a40',
                        'card-back': '#3498db',
                        'card-red': '#e74c3c',
                        'card-black': '#2c3e50',
                        'table-green': '#0a7e33',
                    }
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .card {
                @apply w-16 h-24 bg-white rounded-md shadow-md flex flex-col items-center justify-center text-lg font-bold relative overflow-hidden border-2 border-white;
                transition: all 0.2s ease;
            }
            .card-back {
                @apply bg-gradient-to-br from-blue-500 to-blue-700 text-white border-2 border-blue-300;
            }
            .card-red {
                @apply text-red-600;
            }
            .card-black {
                @apply text-gray-900;
            }
            .card-selected {
                @apply ring-2 ring-yellow-400 transform translate-y-[-10px];
            }
            .card-hover:hover:not(.card-disabled) {
                @apply transform translate-y-[-5px] shadow-lg;
            }
            .btn-primary {
                @apply bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-8 rounded-full shadow-lg transition-all duration-300 transform hover:scale-105 focus:outline-none;
                height: 60px;
                width: 180px;
                display: flex;
                align-items: center;
                justify-content: center;
            }
            .btn-secondary {
                @apply bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-3 px-8 rounded-full shadow-lg transition-all duration-300 transform hover:scale-105 focus:outline-none;
                height: 60px;
                width: 180px;
                display: flex;
                align-items: center;
                justify-content: center;
            }
            .btn-success {
                @apply bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-8 rounded-full shadow-lg transition-all duration-300 transform hover:scale-105 focus:outline-none;
                height: 60px;
                width: 180px;
                display: flex;
                align-items: center;
                justify-content: center;
            }
            .btn-outline {
                @apply border-2 border-white text-white font-bold py-2 px-6 rounded-full shadow-lg transition-all duration-300 transform hover:scale-105 hover:bg-white hover:text-gray-800 focus:outline-none;
            }
            .modal {
                @apply fixed inset-0 flex items-center justify-center z-50 bg-black bg-opacity-50 opacity-0 pointer-events-none transition-opacity duration-300;
            }
            .modal.active {
                @apply opacity-100 pointer-events-auto;
            }
            .modal-content {
                @apply bg-white rounded-lg shadow-xl p-6 transform transition-transform duration-300 scale-95;
                max-width: 90%;
                max-height: 90%;
                overflow-y: auto;
            }
            .modal.active .modal-content {
                @apply scale-100;
            }
            .table-bg {
                background-color: #0a7e33;
                background-image: linear-gradient(rgba(0, 0, 0, 0.1), rgba(0, 0, 0, 0.1)), 
                                  linear-gradient(45deg, #0a6e2e 25%, transparent 25%), 
                                  linear-gradient(-45deg, #0a6e2e 25%, transparent 25%), 
                                  linear-gradient(45deg, transparent 75%, #0a6e2e 75%), 
                                  linear-gradient(-45deg, transparent 75%, #0a6e2e 75%);
                background-size: 20px 20px;
                background-position: 0 0, 0 10px, 10px -10px, -10px 0px, 10px 0px;
            }
        }
    </style>
</head>
<body class="bg-gray-900 min-h-screen flex flex-col">
    <!-- æ¸¸æˆæ ‡é¢˜ -->
    <header class="py-4 bg-gradient-to-r from-red-700 to-red-900 text-white shadow-lg">
        <div class="container mx-auto px-4 flex justify-between items-center">
            <h1 class="text-3xl font-bold">å•æœºæ–—åœ°ä¸»</h1>
            <div class="flex space-x-4">
                <button id="btn-settings" class="btn-outline py-1 px-3 h-auto">
                    <i class="fa fa-cog mr-1"></i> è®¾ç½®
                </button>
                <button id="btn-help" class="btn-outline py-1 px-3 h-auto">
                    <i class="fa fa-question-circle mr-1"></i> å¸®åŠ©
                </button>
            </div>
        </div>
    </header>

    <!-- æ¸¸æˆä¸»ç•Œé¢ -->
    <main class="flex-grow table-bg flex flex-col relative overflow-hidden">
        <!-- é¡¶éƒ¨AIç©å®¶åŒºåŸŸ -->
        <div class="p-4 flex justify-between items-center">
            <!-- AI1 -->
            <div class="flex flex-col items-center">
                <div class="w-16 h-16 rounded-full bg-blue-500 mb-2 flex items-center justify-center text-white text-2xl font-bold">
                    <i class="fa fa-user"></i>
                </div>
                <div class="bg-black bg-opacity-50 rounded-lg px-3 py-1 text-white text-sm">
                    <span id="ai1-name">å†œæ°‘1</span>
                    <span id="ai1-status" class="ml-2 bg-blue-500 text-white px-2 py-1 text-xs rounded-full">ç­‰å¾…ä¸­</span>
                </div>
                <div class="mt-2 text-white text-sm bg-black bg-opacity-50 rounded px-2">
                    å‰©ä½™: <span id="ai1-remaining">17</span> å¼ 
                </div>
            </div>

            <!-- ä¸­é—´åŒºåŸŸ - åº•ç‰Œå’Œå½“å‰ç‰Œ -->
            <div class="flex flex-col items-center">
                <!-- åº•ç‰ŒåŒºåŸŸ -->
                <div id="bottom-cards" class="flex space-x-[-30px] mb-4">
                    <div class="card card-back transform rotate-[-5deg]"></div>
                    <div class="card card-back transform rotate-[0deg]"></div>
                    <div class="card card-back transform rotate-[5deg]"></div>
                </div>
                
                <!-- å½“å‰æ¡Œé¢ä¸Šçš„ç‰Œ -->
                <div id="current-cards" class="flex space-x-[-30px] min-h-[80px]">
                    <!-- å‡ºç‰Œåä¼šåŠ¨æ€æ·»åŠ  -->
                </div>
                
                <!-- æ¸¸æˆçŠ¶æ€æç¤º -->
                <div id="game-status" class="mt-4 bg-black bg-opacity-70 text-white px-4 py-2 rounded-lg text-center">
                    å‡†å¤‡å¼€å§‹æ¸¸æˆ
                </div>
            </div>

            <!-- AI2 -->
            <div class="flex flex-col items-center">
                <div class="w-16 h-16 rounded-full bg-blue-500 mb-2 flex items-center justify-center text-white text-2xl font-bold">
                    <i class="fa fa-user"></i>
                </div>
                <div class="bg-black bg-opacity-50 rounded-lg px-3 py-1 text-white text-sm">
                    <span id="ai2-name">å†œæ°‘2</span>
                    <span id="ai2-status" class="ml-2 bg-blue-500 text-white px-2 py-1 text-xs rounded-full">ç­‰å¾…ä¸­</span>
                </div>
                <div class="mt-2 text-white text-sm bg-black bg-opacity-50 rounded px-2">
                    å‰©ä½™: <span id="ai2-remaining">17</span> å¼ 
                </div>
            </div>
        </div>

        <!-- ä¸­é—´åŒºåŸŸ - AI1çš„ç‰Œ -->
        <div id="ai1-cards" class="flex justify-center space-x-[-40px] mb-8 px-4 overflow-x-auto">
            <!-- ç‰Œä¼šåŠ¨æ€æ·»åŠ  -->
        </div>

        <!-- åº•éƒ¨ç©å®¶åŒºåŸŸ -->
        <div class="mt-auto p-4">
            <!-- ç©å®¶ä¿¡æ¯ -->
            <div class="flex justify-center items-center mb-4">
                <div class="w-16 h-16 rounded-full bg-green-500 mr-3 flex items-center justify-center text-white text-2xl font-bold">
                    <i class="fa fa-user"></i>
                </div>
                <div class="bg-black bg-opacity-50 rounded-lg px-3 py-1 text-white">
                    <span id="player-name">ç©å®¶</span>
                    <span id="player-status" class="ml-2 bg-blue-500 text-white px-2 py-1 text-xs rounded-full">å‡†å¤‡</span>
                </div>
            </div>

            <!-- ç©å®¶çš„ç‰Œ -->
            <div id="player-cards" class="flex justify-center space-x-[-20px] mb-6 px-4 overflow-x-auto min-h-[100px]">
                <!-- ç‰Œä¼šåŠ¨æ€æ·»åŠ  -->
            </div>

            <!-- æ“ä½œæŒ‰é’®åŒºåŸŸ -->
            <div id="action-buttons" class="flex justify-center space-x-4 mb-4">
                <button id="btn-start" class="btn-primary">å¼€å§‹æ¸¸æˆ</button>
            </div>
        </div>
    </main>

    <!-- æ¸¸æˆç»Ÿè®¡ä¿¡æ¯ -->
    <footer class="bg-gray-800 text-white py-2 px-4">
        <div class="container mx-auto flex justify-between items-center">
            <div class="flex space-x-4">
                <div>
                    <span class="text-gray-400">æ€»åœºæ¬¡:</span>
                    <span id="total-games" class="ml-1">0</span>
                </div>
                <div>
                    <span class="text-gray-400">èƒœç‡:</span>
                    <span id="win-rate" class="ml-1">0%</span>
                </div>
            </div>
            <div>
                <span class="text-gray-400">éš¾åº¦:</span>
                <span id="current-difficulty" class="ml-1">ä¸­ç­‰</span>
            </div>
        </div>
    </footer>

    <!-- è®¾ç½®å¼¹çª— -->
    <div id="settings-modal" class="modal">
        <div class="modal-content bg-gray-800 text-white max-w-md">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-2xl font-bold">æ¸¸æˆè®¾ç½®</h2>
                <button class="close-modal text-gray-400 hover:text-white">
                    <i class="fa fa-times text-xl"></i>
                </button>
            </div>
            <div class="mb-4">
                <label class="block text-gray-300 mb-2">æ¸¸æˆéš¾åº¦</label>
                <div class="flex space-x-4">
                    <label class="flex items-center cursor-pointer">
                        <input type="radio" name="difficulty" value="easy" class="mr-2">
                        <span>ç®€å•</span>
                    </label>
                    <label class="flex items-center cursor-pointer">
                        <input type="radio" name="difficulty" value="medium" checked class="mr-2">
                        <span>ä¸­ç­‰</span>
                    </label>
                    <label class="flex items-center cursor-pointer">
                        <input type="radio" name="difficulty" value="hard" class="mr-2">
                        <span>å›°éš¾</span>
                    </label>
                </div>
            </div>
            <div class="flex justify-end">
                <button id="btn-save-settings" class="btn-outline py-1 px-4 h-auto">ä¿å­˜è®¾ç½®</button>
            </div>
        </div>
    </div>

    <!-- å¸®åŠ©å¼¹çª— -->
    <div id="help-modal" class="modal">
        <div class="modal-content bg-gray-800 text-white max-w-lg">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-2xl font-bold">æ¸¸æˆå¸®åŠ©</h2>
                <button class="close-modal text-gray-400 hover:text-white">
                    <i class="fa fa-times text-xl"></i>
                </button>
            </div>
            <div class="space-y-4">
                <div>
                    <h3 class="text-xl font-semibold mb-2">æ¸¸æˆè§„åˆ™</h3>
                    <p class="text-gray-300">æ–—åœ°ä¸»æ˜¯ä¸€ç§ä¸‰äººæ‰‘å…‹æ¸¸æˆï¼Œä½¿ç”¨ä¸€å‰¯54å¼ çš„æ‰‘å…‹ç‰Œï¼ˆåŒ…æ‹¬å¤§å°ç‹ï¼‰ã€‚æ¸¸æˆåˆ†ä¸ºåœ°ä¸»å’Œå†œæ°‘ä¸¤æ–¹ï¼Œåœ°ä¸»ä¸€äººï¼Œå†œæ°‘ä¸¤äººã€‚</p>
                </div>
                <div>
                    <h4 class="text-lg font-semibold mb-1">åŸºæœ¬æµç¨‹</h4>
                    <ol class="list-decimal list-inside text-gray-300 space-y-1">
                        <li>å‘ç‰Œï¼šæ¯äººå‘17å¼ ç‰Œï¼Œå‰©ä½™3å¼ ä½œä¸ºåº•ç‰Œ</li>
                        <li>å«åœ°ä¸»ï¼šç©å®¶è½®æµå«åœ°ä¸»ï¼Œå«åœ°ä¸»çš„ç©å®¶è·å¾—åº•ç‰Œ</li>
                        <li>å‡ºç‰Œï¼šåœ°ä¸»å…ˆå‡ºç‰Œï¼Œç„¶åæŒ‰é€†æ—¶é’ˆé¡ºåºè½®æµå‡ºç‰Œ</li>
                        <li>èƒœè´Ÿï¼šå…ˆå‡ºå®Œç‰Œçš„ä¸€æ–¹è·èƒœ</li>
                    </ol>
                </div>
                <div>
                    <h4 class="text-lg font-semibold mb-1">æ“ä½œè¯´æ˜</h4>
                    <ul class="list-disc list-inside text-gray-300 space-y-1">
                        <li>ç‚¹å‡»é€‰æ‹©è¦å‡ºçš„ç‰Œ</li>
                        <li>ç‚¹å‡»"å‡ºç‰Œ"æŒ‰é’®å‡ºé€‰ä¸­çš„ç‰Œ</li>
                        <li>æ— æ³•å‡ºç‰Œæ—¶ç‚¹å‡»"ä¸å‡º"æŒ‰é’®</li>
                    </ul>
                </div>
            </div>
            <div class="mt-6 flex justify-end">
                <button class="close-modal btn-outline py-1 px-4 h-auto">å…³é—­</button>
            </div>
        </div>
    </div>

    <!-- æ¸¸æˆç»“æŸå¼¹çª— -->
    <div id="game-over-modal" class="modal">
        <div class="modal-content bg-gray-800 text-white max-w-md">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-2xl font-bold" id="game-over-title">æ¸¸æˆç»“æŸ</h2>
                <button class="close-modal text-gray-400 hover:text-white">
                    <i class="fa fa-times text-xl"></i>
                </button>
            </div>
            <div class="text-center py-4">
                <div id="game-over-message" class="text-xl mb-4">æ­å–œä½ è·å¾—äº†èƒœåˆ©ï¼</div>
                <div class="flex justify-center space-x-4">
                    <button id="btn-new-game" class="btn-primary">å†æ¥ä¸€å±€</button>
                </div>
            </div>
        </div>
    </div>

    <!-- å«åœ°ä¸»å¼¹çª— -->
    <div id="call-landlord-modal" class="modal">
        <div class="modal-content bg-gray-800 text-white max-w-md p-0 overflow-hidden">
            <div class="bg-gradient-to-r from-yellow-600 to-yellow-800 py-3 px-6">
                <h2 class="text-xl font-bold">å«åœ°ä¸»</h2>
            </div>
            <div class="p-6">
                <div class="text-center mb-6">
                    <p class="mb-4">æ˜¯å¦è¦å«åœ°ä¸»ï¼Ÿ</p>
                    <div class="flex justify-center space-x-[-30px] mb-4">
                        <div class="card card-back transform rotate-[-5deg]"></div>
                        <div class="card card-back transform rotate-[0deg]"></div>
                        <div class="card card-back transform rotate-[5deg]"></div>
                    </div>
                    <p class="text-sm text-gray-400">å«åœ°ä¸»åå°†è·å¾—è¿™ä¸‰å¼ åº•ç‰Œ</p>
                </div>
                <div class="flex justify-center space-x-4">
                    <button id="btn-no-call" class="btn-outline py-1 px-4 h-auto">ä¸å«</button>
                    <button id="btn-call" class="btn-primary">å«åœ°ä¸»</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        console.log('æ–—åœ°ä¸»æ¸¸æˆåŠ è½½ä¸­...');

        // æ¸¸æˆæ•°æ®å’ŒçŠ¶æ€
        const gameState = {
            currentPlayer: 0, // 0: ç©å®¶, 1: AI1, 2: AI2
            landlord: -1, // -1: æœªç¡®å®š, 0-2: ç©å®¶ç´¢å¼•
            currentCards: [], // å½“å‰æ¡Œé¢ä¸Šçš„ç‰Œ
            playerCards: [], // ç©å®¶çš„ç‰Œ
            ai1Cards: [], // AI1çš„ç‰Œ
            ai2Cards: [], // AI2çš„ç‰Œ
            bottomCards: [], // åº•ç‰Œ
            gamePhase: 'ready', // ready: å‡†å¤‡é˜¶æ®µ, dealing: å‘ç‰Œé˜¶æ®µ, calling: å«åœ°ä¸»é˜¶æ®µ, playing: å‡ºç‰Œé˜¶æ®µ, ended: æ¸¸æˆç»“æŸ
            difficulty: 'medium', // easy, medium, hard
            selectedCards: [], // ç©å®¶é€‰ä¸­çš„ç‰Œ
            lastPlayer: -1, // ä¸Šä¸€ä¸ªå‡ºç‰Œçš„ç©å®¶
            gameStarted: false // æ¸¸æˆæ˜¯å¦å·²å¼€å§‹
        };

        // å¡ç‰Œæ•°æ®
        const cardValues = ['3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K', 'A', '2', 'S', 'B'];
        const cardSuits = ['hearts', 'diamonds', 'clubs', 'spades'];
        const cardWeights = {
            '3': 3, '4': 4, '5': 5, '6': 6, '7': 7, '8': 8, '9': 9, '10': 10,
            'J': 11, 'Q': 12, 'K': 13, 'A': 14, '2': 15, 'S': 16, 'B': 17
        };
        const cardSuitSymbols = {
            'hearts': 'â™¥',
            'diamonds': 'â™¦',
            'clubs': 'â™£',
            'spades': 'â™ '
        };

        // DOMå…ƒç´ 
        const elements = {
            btnStart: document.getElementById('btn-start'),
            btnSettings: document.getElementById('btn-settings'),
            btnHelp: document.getElementById('btn-help'),
            btnSaveSettings: document.getElementById('btn-save-settings'),
            btnNewGame: document.getElementById('btn-new-game'),
            btnCall: document.getElementById('btn-call'),
            btnNoCall: document.getElementById('btn-no-call'),
            
            playerCards: document.getElementById('player-cards'),
            ai1Cards: document.getElementById('ai1-cards'),
            ai2Cards: document.getElementById('ai2-cards'),
            bottomCards: document.getElementById('bottom-cards'),
            currentCards: document.getElementById('current-cards'),
            
            gameStatus: document.getElementById('game-status'),
            playerStatus: document.getElementById('player-status'),
            ai1Status: document.getElementById('ai1-status'),
            ai2Status: document.getElementById('ai2-status'),
            
            ai1Remaining: document.getElementById('ai1-remaining'),
            ai2Remaining: document.getElementById('ai2-remaining'),
            
            totalGames: document.getElementById('total-games'),
            winRate: document.getElementById('win-rate'),
            currentDifficulty: document.getElementById('current-difficulty'),
            
            settingsModal: document.getElementById('settings-modal'),
            helpModal: document.getElementById('help-modal'),
            gameOverModal: document.getElementById('game-over-modal'),
            callLandlordModal: document.getElementById('call-landlord-modal'),
            
            gameOverTitle: document.getElementById('game-over-title'),
            gameOverMessage: document.getElementById('game-over-message')
        };

        // åˆå§‹åŒ–æ¸¸æˆ
        function initGame() {
            console.log('å¼€å§‹åˆå§‹åŒ–æ¸¸æˆ...');
            
            // æ£€æŸ¥DOMå…ƒç´ 
            console.log('æ£€æŸ¥DOMå…ƒç´ :');
            console.log('btnStart:', elements.btnStart);
            console.log('playerCards:', elements.playerCards);
            console.log('gameStatus:', elements.gameStatus);
            
            // ç»‘å®šäº‹ä»¶ç›‘å¬å™¨
            bindEventListeners();
            console.log('äº‹ä»¶ç›‘å¬å™¨ç»‘å®šå®Œæˆ');
            
            // è®¾ç½®åˆå§‹æ¸¸æˆçŠ¶æ€
            resetGameState();
            console.log('åˆå§‹æ¸¸æˆçŠ¶æ€è®¾ç½®å®Œæˆ');
            
            console.log('æ¸¸æˆåˆå§‹åŒ–å®Œæˆï¼');
        }

        // ç»‘å®šäº‹ä»¶ç›‘å¬å™¨
        function bindEventListeners() {
            // å¼€å§‹æ¸¸æˆæŒ‰é’®
            elements.btnStart.addEventListener('click', startGame);
            console.log('å¼€å§‹æ¸¸æˆæŒ‰é’®äº‹ä»¶å·²ç»‘å®š');
            
            // è®¾ç½®æŒ‰é’®
            elements.btnSettings.addEventListener('click', () => {
                elements.settingsModal.classList.add('active');
            });
            
            // å¸®åŠ©æŒ‰é’®
            elements.btnHelp.addEventListener('click', () => {
                elements.helpModal.classList.add('active');
            });
            
            // ä¿å­˜è®¾ç½®æŒ‰é’®
            elements.btnSaveSettings.addEventListener('click', saveSettings);
            
            // æ–°æ¸¸æˆæŒ‰é’®
            elements.btnNewGame.addEventListener('click', () => {
                elements.gameOverModal.classList.remove('active');
                resetGameState();
                startGame();
            });
            
            // å«åœ°ä¸»æŒ‰é’®
            elements.btnCall.addEventListener('click', () => {
                callLandlord(0); // ç©å®¶å«åœ°ä¸»
                elements.callLandlordModal.classList.remove('active');
            });
            
            // ä¸å«åœ°ä¸»æŒ‰é’®
            elements.btnNoCall.addEventListener('click', () => {
                elements.callLandlordModal.classList.remove('active');
                continueCallingLandlord();
            });
            
            // å…³é—­å¼¹çª—æŒ‰é’®
            document.querySelectorAll('.close-modal').forEach(btn => {
                btn.addEventListener('click', function() {
                    this.closest('.modal').classList.remove('active');
                });
            });
            
            // ç‚¹å‡»å¼¹çª—èƒŒæ™¯å…³é—­å¼¹çª—
            document.querySelectorAll('.modal').forEach(modal => {
                modal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        this.classList.remove('active');
                    }
                });
            });
        }

        // é‡ç½®æ¸¸æˆçŠ¶æ€
        function resetGameState() {
            gameState.currentPlayer = 0;
            gameState.landlord = -1;
            gameState.currentCards = [];
            gameState.playerCards = [];
            gameState.ai1Cards = [];
            gameState.ai2Cards = [];
            gameState.bottomCards = [];
            gameState.gamePhase = 'ready';
            gameState.selectedCards = [];
            gameState.lastPlayer = -1;
            gameState.gameStarted = false;
            
            // é‡ç½®UI
            elements.playerCards.innerHTML = '';
            elements.ai1Cards.innerHTML = '';
            elements.ai2Cards.innerHTML = '';
            elements.currentCards.innerHTML = '';
            elements.bottomCards.innerHTML = '';
            
            // é‡ç½®ç©å®¶çŠ¶æ€
            elements.playerStatus.textContent = 'å‡†å¤‡';
            elements.ai1Status.textContent = 'ç­‰å¾…ä¸­';
            elements.ai2Status.textContent = 'ç­‰å¾…ä¸­';
            
            // é‡ç½®å‰©ä½™ç‰Œæ•°
            elements.ai1Remaining.textContent = '17';
            elements.ai2Remaining.textContent = '17';
            
            // é‡ç½®æ¸¸æˆçŠ¶æ€æç¤º
            elements.gameStatus.textContent = 'å‡†å¤‡å¼€å§‹æ¸¸æˆ';
            
            // é‡ç½®æ“ä½œæŒ‰é’®
            const actionButtons = document.getElementById('action-buttons');
            actionButtons.innerHTML = '<button id="btn-start" class="btn-primary">å¼€å§‹æ¸¸æˆ</button>';
            
            // é‡æ–°è·å–btnStartå…ƒç´ å¹¶ç»‘å®šäº‹ä»¶
            elements.btnStart = document.getElementById('btn-start');
            elements.btnStart.addEventListener('click', startGame);
            console.log('å¼€å§‹æŒ‰é’®å·²é‡æ–°åˆ›å»ºå¹¶ç»‘å®šäº‹ä»¶');
        }

        // å¼€å§‹æ¸¸æˆ
        function startGame() {
            console.log('å¼€å§‹æ¸¸æˆæŒ‰é’®è¢«ç‚¹å‡»');
            
            if (gameState.gameStarted) {
                console.log('æ¸¸æˆå·²ç»å¼€å§‹ï¼Œä¸èƒ½é‡å¤å¼€å§‹');
                return;
            }
            
            try {
                gameState.gameStarted = true;
                gameState.gamePhase = 'dealing';
                console.log('æ¸¸æˆçŠ¶æ€æ›´æ–°ä¸º:', gameState.gamePhase);
                
                // æ›´æ–°æ¸¸æˆçŠ¶æ€æç¤º
                elements.gameStatus.textContent = 'æ­£åœ¨å‘ç‰Œ...';
                console.log('æ¸¸æˆçŠ¶æ€æç¤ºå·²æ›´æ–°');
                
                // åˆ›å»ºå¹¶æ´—ç‰Œ
                console.log('å¼€å§‹åˆ›å»ºç‰Œç»„...');
                const deck = createDeck();
                console.log('ç‰Œç»„åˆ›å»ºå®Œæˆï¼Œå…±', deck.length, 'å¼ ç‰Œ');
                
                console.log('å¼€å§‹æ´—ç‰Œ...');
                shuffleDeck(deck);
                console.log('æ´—ç‰Œå®Œæˆ');
                
                // å‘ç‰Œ
                console.log('å¼€å§‹å‘ç‰Œ...');
                dealCards(deck);
                console.log('å‘ç‰Œå®Œæˆ');
                
                // æ˜¾ç¤ºåº•ç‰Œ
                console.log('æ˜¾ç¤ºåº•ç‰Œ...');
                showBottomCards();
                console.log('åº•ç‰Œæ˜¾ç¤ºå®Œæˆ');
                
                // å¼€å§‹å«åœ°ä¸»é˜¶æ®µ
                setTimeout(() => {
                    console.log('å¼€å§‹å«åœ°ä¸»é˜¶æ®µ');
                    gameState.gamePhase = 'calling';
                    elements.gameStatus.textContent = 'å¼€å§‹å«åœ°ä¸»';
                    startCallingLandlord();
                }, 1500);
            } catch (error) {
                console.error('å¼€å§‹æ¸¸æˆæ—¶å‘ç”Ÿé”™è¯¯:', error);
                elements.gameStatus.textContent = 'æ¸¸æˆå¯åŠ¨å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•';
            }
        }

        // åˆ›å»ºç‰Œç»„
        function createDeck() {
            const deck = [];
            
            // æ·»åŠ æ™®é€šç‰Œ
            cardSuits.forEach(suit => {
                cardValues.forEach(value => {
                    if (value !== 'S' && value !== 'B') { // æ’é™¤å¤§å°ç‹
                        deck.push({
                            value: value,
                            suit: suit,
                            weight: cardWeights[value],
                            displayValue: value === '10' ? '10' : value.charAt(0),
                            suitSymbol: cardSuitSymbols[suit],
                            colorClass: (suit === 'hearts' || suit === 'diamonds') ? 'card-red' : 'card-black'
                        });
                    }
                });
            });
            
            // æ·»åŠ å°ç‹
            deck.push({
                value: 'S',
                suit: 'little_joker',
                weight: cardWeights['S'],
                displayValue: 'S',
                suitSymbol: 'ğŸƒ',
                colorClass: 'card-black'
            });
            
            // æ·»åŠ å¤§ç‹
            deck.push({
                value: 'B',
                suit: 'big_joker',
                weight: cardWeights['B'],
                displayValue: 'B',
                suitSymbol: 'ğŸƒ',
                colorClass: 'card-red'
            });
            
            return deck;
        }

        // æ´—ç‰Œ
        function shuffleDeck(deck) {
            for (let i = deck.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [deck[i], deck[j]] = [deck[j], deck[i]];
            }
            return deck;
        }

        // å‘ç‰Œ
        function dealCards(deck) {
            // ç•™å‡º3å¼ åº•ç‰Œ
            gameState.bottomCards = deck.slice(0, 3);
            const remainingDeck = deck.slice(3);
            
            // å‘ç‰Œç»™ä¸‰ä¸ªç©å®¶
            for (let i = 0; i < remainingDeck.length; i++) {
                if (i % 3 === 0) {
                    gameState.playerCards.push(remainingDeck[i]);
                } else if (i % 3 === 1) {
                    gameState.ai1Cards.push(remainingDeck[i]);
                } else {
                    gameState.ai2Cards.push(remainingDeck[i]);
                }
            }
            
            // æ’åºç©å®¶çš„ç‰Œ
            sortCards(gameState.playerCards);
            sortCards(gameState.ai1Cards);
            sortCards(gameState.ai2Cards);
            
            // æ˜¾ç¤ºç©å®¶çš„ç‰Œ
            displayPlayerCards();
            
            // æ˜¾ç¤ºAIçš„ç‰Œï¼ˆèƒŒé¢ï¼‰
            displayAICards();
        }

        // æ’åºç‰Œ
        function sortCards(cards) {
            cards.sort((a, b) => {
                // å…ˆæŒ‰æƒé‡æ’åº
                if (a.weight !== b.weight) {
                    return a.weight - b.weight;
                }
                return 0;
            });
        }

        // æ˜¾ç¤ºç©å®¶çš„ç‰Œ
        function displayPlayerCards() {
            elements.playerCards.innerHTML = '';
            
            gameState.playerCards.forEach((card, index) => {
                const cardElement = createCardElement(card, index, 'player');
                elements.playerCards.appendChild(cardElement);
            });
            
            console.log('ç©å®¶çš„ç‰Œæ˜¾ç¤ºå®Œæˆï¼Œå…±', gameState.playerCards.length, 'å¼ ');
        }

        // æ˜¾ç¤ºAIçš„ç‰Œ
        function displayAICards() {
            // æ˜¾ç¤ºAI1çš„ç‰Œ
            elements.ai1Cards.innerHTML = '';
            for (let i = 0; i < gameState.ai1Cards.length; i++) {
                const cardElement = createCardBackElement(i, 'ai1');
                elements.ai1Cards.appendChild(cardElement);
            }
            
            // æ˜¾ç¤ºAI2çš„ç‰Œ
            elements.ai2Cards.innerHTML = '';
            for (let i = 0; i < gameState.ai2Cards.length; i++) {
                const cardElement = createCardBackElement(i, 'ai2');
                elements.ai2Cards.appendChild(cardElement);
            }
            
            console.log('AIçš„ç‰Œæ˜¾ç¤ºå®Œæˆ');
        }

        // æ˜¾ç¤ºåº•ç‰Œ
        function showBottomCards() {
            elements.bottomCards.innerHTML = '';
            
            gameState.bottomCards.forEach((card, index) => {
                const cardElement = createCardBackElement(index, 'bottom');
                cardElement.style.transform = `rotate(${index * 5 - 5}deg)`;
                elements.bottomCards.appendChild(cardElement);
            });
            
            console.log('åº•ç‰Œæ˜¾ç¤ºå®Œæˆ');
        }

        // åˆ›å»ºå¡ç‰Œå…ƒç´ 
        function createCardElement(card, index, owner) {
            console.log('åˆ›å»ºå¡ç‰Œå…ƒç´ :', card.displayValue, card.suitSymbol, 'ç´¢å¼•:', index, 'æ‰€æœ‰è€…:', owner);
            
            const cardElement = document.createElement('div');
            cardElement.className = `card card-hover ${card.colorClass}`;
            cardElement.dataset.index = index;
            cardElement.dataset.owner = owner;
            
            // æ·»åŠ å¡ç‰Œå†…å®¹
            cardElement.innerHTML = `
                <div class="text-base absolute top-1 left-2 font-bold">${card.displayValue}</div>
                <div class="text-lg absolute top-6 left-2">${card.suitSymbol}</div>
                <div class="text-base absolute bottom-1 right-2 font-bold">${card.displayValue}</div>
                <div class="text-lg absolute bottom-6 right-2 transform rotate-180">${card.suitSymbol}</div>
            `;
            
            // æ·»åŠ ç‚¹å‡»äº‹ä»¶
            if (owner === 'player') {
                cardElement.addEventListener('click', () => {
                    console.log('å¡ç‰Œè¢«ç‚¹å‡»:', index);
                    toggleCardSelection(index);
                });
            }
            
            return cardElement;
        }

        // åˆ›å»ºå¡ç‰ŒèƒŒé¢å…ƒç´ 
        function createCardBackElement(index, owner) {
            const cardElement = document.createElement('div');
            cardElement.className = 'card card-back';
            cardElement.dataset.index = index;
            cardElement.dataset.owner = owner;
            
            return cardElement;
        }

        // åˆ‡æ¢å¡ç‰Œé€‰æ‹©çŠ¶æ€
        function toggleCardSelection(index) {
            // åªæœ‰åœ¨ç©å®¶å›åˆæ‰èƒ½é€‰æ‹©å¡ç‰Œ
            if (gameState.gamePhase !== 'playing' || gameState.currentPlayer !== 0) {
                return;
            }
            
            const cardElement = elements.playerCards.children[index];
            const isSelected = cardElement.classList.contains('card-selected');
            
            if (isSelected) {
                // å–æ¶ˆé€‰æ‹©
                cardElement.classList.remove('card-selected');
                gameState.selectedCards = gameState.selectedCards.filter(i => i !== index);
            } else {
                // é€‰æ‹©å¡ç‰Œ
                cardElement.classList.add('card-selected');
                gameState.selectedCards.push(index);
            }
            
            console.log('å½“å‰é€‰ä¸­çš„ç‰Œç´¢å¼•:', gameState.selectedCards);
            
            // æ›´æ–°å‡ºç‰ŒæŒ‰é’®çŠ¶æ€
            updateActionButtons();
        }

        // æ›´æ–°æ“ä½œæŒ‰é’®
        function updateActionButtons() {
            const actionButtons = document.getElementById('action-buttons');
            
            if (gameState.gamePhase === 'playing' && gameState.currentPlayer === 0) {
                // ç©å®¶å›åˆ
                const canPlay = canPlayCards(getSelectedCardObjects(), gameState.currentCards);
                
                actionButtons.innerHTML = `
                    <button id="btn-play" class="btn-success">å‡ºç‰Œ</button>
                    <button id="btn-pass" class="btn-outline py-2 px-6 h-auto">ä¸å‡º</button>
                `;
                
                // ç»‘å®šäº‹ä»¶
                document.getElementById('btn-play').addEventListener('click', () => {
                    if (canPlay || gameState.selectedCards.length === 0) {
                        playSelectedCards();
                    }
                });
                
                document.getElementById('btn-pass').addEventListener('click', passTurn);
            }
        }

        // è·å–é€‰ä¸­çš„å¡ç‰Œå¯¹è±¡
        function getSelectedCardObjects() {
            return gameState.selectedCards
                .sort((a, b) => a - b)
                .map(index => gameState.playerCards[index]);
        }

        // å¼€å§‹å«åœ°ä¸»é˜¶æ®µ
        function startCallingLandlord() {
            // éšæœºé€‰æ‹©èµ·å§‹å«åœ°ä¸»çš„ç©å®¶
            gameState.currentPlayer = Math.floor(Math.random() * 3);
            
            // æ›´æ–°æ¸¸æˆçŠ¶æ€æç¤º
            updateGameStatus(`${getPlayerName(gameState.currentPlayer)}çš„å«åœ°ä¸»å›åˆ`);
            
            // å¼€å§‹å«åœ°ä¸»æµç¨‹
            if (gameState.currentPlayer === 0) {
                // ç©å®¶çš„å›åˆï¼Œæ˜¾ç¤ºå«åœ°ä¸»å¼¹çª—
                setTimeout(() => {
                    elements.callLandlordModal.classList.add('active');
                }, 500);
            } else {
                // AIçš„å›åˆ
                setTimeout(() => {
                    aiCallLandlord(gameState.currentPlayer);
                }, 1000);
            }
        }

        // ç»§ç»­å«åœ°ä¸»æµç¨‹
        function continueCallingLandlord() {
            // ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªç©å®¶
            gameState.currentPlayer = (gameState.currentPlayer + 1) % 3;
            
            // æ£€æŸ¥æ˜¯å¦å·²ç»æœ‰ç©å®¶å«åœ°ä¸»
            if (gameState.landlord !== -1) {
                // å¼€å§‹å‡ºç‰Œé˜¶æ®µ
                startPlayingPhase();
                return;
            }
            
            // æ›´æ–°æ¸¸æˆçŠ¶æ€æç¤º
            updateGameStatus(`${getPlayerName(gameState.currentPlayer)}çš„å«åœ°ä¸»å›åˆ`);
            
            // ç»§ç»­å«åœ°ä¸»æµç¨‹
            if (gameState.currentPlayer === 0) {
                // ç©å®¶çš„å›åˆï¼Œæ˜¾ç¤ºå«åœ°ä¸»å¼¹çª—
                setTimeout(() => {
                    elements.callLandlordModal.classList.add('active');
                }, 500);
            } else {
                // AIçš„å›åˆ
                setTimeout(() => {
                    aiCallLandlord(gameState.currentPlayer);
                }, 1000);
            }
        }

        // å«åœ°ä¸»
        function callLandlord(playerIndex) {
            gameState.landlord = playerIndex;
            
            // æ›´æ–°æ¸¸æˆçŠ¶æ€æç¤º
            updateGameStatus(`${getPlayerName(playerIndex)}å«äº†åœ°ä¸»`);
            
            // ç»§ç»­å«åœ°ä¸»æµç¨‹
            setTimeout(() => {
                continueCallingLandlord();
            }, 1000);
        }

        // AIå«åœ°ä¸»å†³ç­–
        function aiCallLandlord(playerIndex) {
            const cards = playerIndex === 1 ? gameState.ai1Cards : gameState.ai2Cards;
            let callProbability = 0.3; // åŸºç¡€å«åœ°ä¸»æ¦‚ç‡
            
            // æ ¹æ®ç‰Œçš„è´¨é‡è°ƒæ•´å«åœ°ä¸»æ¦‚ç‡
            const cardQuality = evaluateCardQuality(cards);
            callProbability += cardQuality * 0.5;
            
            // æ ¹æ®éš¾åº¦è°ƒæ•´å†³ç­–
            if (gameState.difficulty === 'easy') {
                callProbability *= 0.7;
            } else if (gameState.difficulty === 'hard') {
                callProbability = cardQuality > 0.5 ? 0.8 : 0.1;
            }
            
            // éšæœºå†³å®šæ˜¯å¦å«åœ°ä¸»
            const willCall = Math.random() < callProbability;
            
            if (willCall) {
                // AIå«åœ°ä¸»
                callLandlord(playerIndex);
            } else {
                // AIä¸å«åœ°ä¸»
                updateGameStatus(`${getPlayerName(playerIndex)}ä¸å«åœ°ä¸»`);
                
                // ç»§ç»­å«åœ°ä¸»æµç¨‹
                setTimeout(() => {
                    continueCallingLandlord();
                }, 1000);
            }
        }

        // è¯„ä¼°ç‰Œçš„è´¨é‡
        function evaluateCardQuality(cards) {
            let score = 0;
            
            // è®¡ç®—ç‚¸å¼¹æ•°é‡
            const valueCount = {};
            cards.forEach(card => {
                valueCount[card.value] = (valueCount[card.value] || 0) + 1;
            });
            
            let bombCount = 0;
            for (const value in valueCount) {
                if (valueCount[value] === 4) {
                    bombCount++;
                }
            }
            
            // è®¡ç®—ç‹ç‚¸
            const hasLittleJoker = cards.some(card => card.value === 'S');
            const hasBigJoker = cards.some(card => card.value === 'B');
            const hasJokerBomb = hasLittleJoker && hasBigJoker;
            
            // è®¡ç®—å¤§ç‰Œæ•°é‡
            const bigCards = cards.filter(card => card.weight >= 14); // A, 2, ç‹
            
            // ç»¼åˆè¯„åˆ†
            score += bombCount * 0.2;
            score += hasJokerBomb ? 0.3 : 0;
            score += (hasLittleJoker || hasBigJoker) ? 0.1 : 0;
            score += bigCards.length / cards.length * 0.3;
            
            return Math.min(score, 1);
        }

        // å¼€å§‹å‡ºç‰Œé˜¶æ®µ
        function startPlayingPhase() {
            gameState.gamePhase = 'playing';
            
            // å°†åº•ç‰Œç»™åœ°ä¸»
            giveBottomCardsToLandlord();
            
            // æ˜¾ç¤ºåº•ç‰Œ
            revealBottomCards();
            
            // åœ°ä¸»å…ˆå‡ºç‰Œ
            gameState.currentPlayer = gameState.landlord;
            
            // æ›´æ–°æ¸¸æˆçŠ¶æ€æç¤º
            updateGameStatus(`${getPlayerName(gameState.currentPlayer)}çš„å›åˆ`);
            
            // æ›´æ–°å‰©ä½™ç‰Œæ•°
            updateRemainingCards();
            
            // å¦‚æœæ˜¯ç©å®¶çš„å›åˆï¼Œæ˜¾ç¤ºæ“ä½œæŒ‰é’®
            if (gameState.currentPlayer === 0) {
                updateActionButtons();
            } else {
                // AIçš„å›åˆ
                setTimeout(() => {
                    aiPlayTurn(gameState.currentPlayer);
                }, 1000);
            }
        }

        // å°†åº•ç‰Œç»™åœ°ä¸»
        function giveBottomCardsToLandlord() {
            if (gameState.landlord === 0) {
                gameState.playerCards = [...gameState.playerCards, ...gameState.bottomCards];
                sortCards(gameState.playerCards);
            } else if (gameState.landlord === 1) {
                gameState.ai1Cards = [...gameState.ai1Cards, ...gameState.bottomCards];
                sortCards(gameState.ai1Cards);
            } else {
                gameState.ai2Cards = [...gameState.ai2Cards, ...gameState.bottomCards];
                sortCards(gameState.ai2Cards);
            }
        }

        // æ˜¾ç¤ºåº•ç‰Œ
        function revealBottomCards() {
            elements.bottomCards.innerHTML = '';
            
            gameState.bottomCards.forEach((card, index) => {
                const cardElement = createCardElement(card, index, 'bottom');
                cardElement.style.transform = `rotate(${index * 5 - 5}deg)`;
                elements.bottomCards.appendChild(cardElement);
            });
        }

        // æ›´æ–°å‰©ä½™ç‰Œæ•°
        function updateRemainingCards() {
            elements.ai1Remaining.textContent = gameState.ai1Cards.length;
            elements.ai2Remaining.textContent = gameState.ai2Cards.length;
        }

        // ç©å®¶å‡ºç‰Œ
        function playSelectedCards() {
            if (gameState.selectedCards.length === 0) return;
            
            const selectedCardObjects = getSelectedCardObjects();
            
            // æ£€æŸ¥æ˜¯å¦å¯ä»¥å‡ºç‰Œ
            if (!canPlayCards(selectedCardObjects, gameState.currentCards)) {
                elements.gameStatus.textContent = 'ä¸èƒ½å‡ºè¿™ç§ç‰Œå‹ï¼';
                return;
            }
            
            // å‡ºç‰Œ
            playCards(selectedCardObjects, 0);
            
            // ä»ç©å®¶æ‰‹ä¸­ç§»é™¤å‡ºçš„ç‰Œ
            gameState.selectedCards.sort((a, b) => b - a).forEach(index => {
                gameState.playerCards.splice(index, 1);
            });
            
            // æ¸…ç©ºé€‰ä¸­çš„ç‰Œ
            gameState.selectedCards = [];
            
            // æ›´æ–°ç©å®¶çš„ç‰Œæ˜¾ç¤º
            displayPlayerCards();
            
            // æ£€æŸ¥æ¸¸æˆæ˜¯å¦ç»“æŸ
            if (gameState.playerCards.length === 0) {
                endGame(0);
                return;
            }
            
            // ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªç©å®¶
            nextPlayer();
        }

        // å‡ºç‰Œ
        function playCards(cards, playerIndex) {
            // æ›´æ–°å½“å‰æ¡Œé¢ä¸Šçš„ç‰Œ
            gameState.currentCards = cards;
            
            // æ›´æ–°æ¸¸æˆçŠ¶æ€æç¤º
            updateGameStatus(`${getPlayerName(playerIndex)}å‡ºäº†ç‰Œ`);
            
            // æ˜¾ç¤ºå½“å‰æ¡Œé¢ä¸Šçš„ç‰Œ
            displayCurrentCards();
            
            // æ›´æ–°ä¸Šä¸€ä¸ªå‡ºç‰Œçš„ç©å®¶
            gameState.lastPlayer = playerIndex;
        }

        // æ˜¾ç¤ºå½“å‰æ¡Œé¢ä¸Šçš„ç‰Œ
        function displayCurrentCards() {
            elements.currentCards.innerHTML = '';
            
            gameState.currentCards.forEach((card, index) => {
                const cardElement = createCardElement(card, index, 'current');
                cardElement.style.transform = `rotate(${index * 2 - gameState.currentCards.length}deg)`;
                elements.currentCards.appendChild(cardElement);
            });
        }

        // ä¸å‡ºç‰Œ
        function passTurn() {
            // æ›´æ–°æ¸¸æˆçŠ¶æ€æç¤º
            updateGameStatus(`${getPlayerName(gameState.currentPlayer)}ä¸å‡º`);
            
            // ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªç©å®¶
            nextPlayer();
        }

        // ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªç©å®¶
        function nextPlayer() {
            // ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªç©å®¶
            gameState.currentPlayer = (gameState.currentPlayer + 1) % 3;
            
            // æ›´æ–°æ¸¸æˆçŠ¶æ€æç¤º
            updateGameStatus(`${getPlayerName(gameState.currentPlayer)}çš„å›åˆ`);
            
            // å¦‚æœæ˜¯ç©å®¶çš„å›åˆï¼Œæ˜¾ç¤ºæ“ä½œæŒ‰é’®
            if (gameState.currentPlayer === 0) {
                updateActionButtons();
            } else {
                // AIçš„å›åˆ
                setTimeout(() => {
                    aiPlayTurn(gameState.currentPlayer);
                }, 1000);
            }
        }

        // AIå‡ºç‰Œå†³ç­–
        function aiPlayTurn(playerIndex) {
            const cards = playerIndex === 1 ? gameState.ai1Cards : gameState.ai2Cards;
            
            // å¯»æ‰¾å¯å‡ºçš„ç‰Œ
            const playableCards = findPlayableCards(cards, gameState.currentCards);
            
            if (playableCards.length > 0) {
                // é€‰æ‹©è¦å‡ºçš„ç‰Œ
                let selectedCards;
                
                if (gameState.difficulty === 'easy') {
                    // ç®€å•éš¾åº¦ï¼šéšæœºé€‰æ‹©
                    selectedCards = playableCards[Math.floor(Math.random() * playableCards.length)];
                } else {
                    // ä¸­ç­‰å’Œå›°éš¾éš¾åº¦ï¼šé€‰æ‹©æœ€ä¼˜ç‰Œ
                    selectedCards = playableCards[0]; // ç®€åŒ–ç‰ˆï¼Œé€‰æ‹©ç¬¬ä¸€å¼ å¯å‡ºç‰Œ
                }
                
                // å‡ºç‰Œ
                playCards(selectedCards, playerIndex);
                
                // ä»AIæ‰‹ä¸­ç§»é™¤å‡ºçš„ç‰Œ
                selectedCards.forEach(card => {
                    const index = cards.findIndex(c => c.value === card.value && c.suit === card.suit);
                    if (index !== -1) {
                        cards.splice(index, 1);
                    }
                });
                
                // æ›´æ–°å‰©ä½™ç‰Œæ•°
                updateRemainingCards();
                
                // æ˜¾ç¤ºAIçš„ç‰Œï¼ˆèƒŒé¢ï¼‰
                displayAICards();
                
                // æ£€æŸ¥æ¸¸æˆæ˜¯å¦ç»“æŸ
                if (cards.length === 0) {
                    endGame(playerIndex);
                    return;
                }
            } else {
                // ä¸å‡ºç‰Œ
                updateGameStatus(`${getPlayerName(playerIndex)}ä¸å‡º`);
            }
            
            // ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªç©å®¶
            setTimeout(() => {
                nextPlayer();
            }, 1000);
        }

        // å¯»æ‰¾å¯å‡ºçš„ç‰Œ
        function findPlayableCards(cards, currentCards) {
            const playable = [];
            
            // å¦‚æœå½“å‰æ¡Œé¢ä¸Šæ²¡æœ‰ç‰Œï¼Œå¯ä»¥å‡ºä»»ä½•ç‰Œå‹
            if (currentCards.length === 0) {
                // ç®€åŒ–ç‰ˆï¼šåªè€ƒè™‘å•ç‰Œã€å¯¹å­ã€ä¸‰å¼ å’Œç‚¸å¼¹
                // å•ç‰Œ
                cards.forEach(card => {
                    playable.push([card]);
                });
                
                // å¯¹å­
                for (let i = 0; i < cards.length - 1; i++) {
                    if (cards[i].weight === cards[i + 1].weight) {
                        playable.push([cards[i], cards[i + 1]]);
                    }
                }
                
                // ä¸‰å¼ 
                for (let i = 0; i < cards.length - 2; i++) {
                    if (cards[i].weight === cards[i + 1].weight && cards[i + 1].weight === cards[i + 2].weight) {
                        playable.push([cards[i], cards[i + 1], cards[i + 2]]);
                    }
                }
            } else {
                // å½“å‰æ¡Œé¢ä¸Šæœ‰ç‰Œï¼Œéœ€è¦å‡ºç›¸åŒç‰Œå‹ä¸”æ›´å¤§çš„ç‰Œ
                const currentType = getCardType(currentCards);
                
                if (currentType.type === 'single') {
                    // æ‰¾æ›´å¤§çš„å•ç‰Œ
                    cards.filter(card => card.weight > currentType.value).forEach(card => {
                        playable.push([card]);
                    });
                } else if (currentType.type === 'pair') {
                    // æ‰¾æ›´å¤§çš„å¯¹å­
                    for (let i = 0; i < cards.length - 1; i++) {
                        if (cards[i].weight === cards[i + 1].weight && cards[i].weight > currentType.value) {
                            playable.push([cards[i], cards[i + 1]]);
                        }
                    }
                }
            }
            
            return playable;
        }

        // è·å–ç‰Œå‹
        function getCardType(cards) {
            if (cards.length === 1) {
                return { type: 'single', value: cards[0].weight };
            } else if (cards.length === 2) {
                if (cards[0].weight === cards[1].weight) {
                    return { type: 'pair', value: cards[0].weight };
                }
            } else if (cards.length === 3) {
                if (cards[0].weight === cards[1].weight && cards[1].weight === cards[2].weight) {
                    return { type: 'triple', value: cards[0].weight };
                }
            }
            
            return { type: 'invalid', value: 0 };
        }

        // æ£€æŸ¥æ˜¯å¦å¯ä»¥å‡ºç‰Œ
        function canPlayCards(cards, currentCards) {
            // ç©ºç‰Œä¸èƒ½å‡º
            if (cards.length === 0) return false;
            
            // è·å–ç‰Œå‹
            const type = getCardType(cards);
            if (type.type === 'invalid') return false;
            
            // å¦‚æœå½“å‰æ¡Œé¢ä¸Šæ²¡æœ‰ç‰Œï¼Œå¯ä»¥å‡ºä»»ä½•æœ‰æ•ˆç‰Œå‹
            if (currentCards.length === 0) return true;
            
            // è·å–å½“å‰ç‰Œå‹
            const currentType = getCardType(currentCards);
            
            // æ£€æŸ¥ç‰Œå‹æ˜¯å¦ç›¸åŒ
            if (type.type !== currentType.type) {
                return false;
            }
            
            // æ£€æŸ¥ç‰Œå‹å¤§å°
            return type.value > currentType.value;
        }

        // æ¸¸æˆç»“æŸ
        function endGame(winnerIndex) {
            gameState.gamePhase = 'ended';
            
            // æ˜¾ç¤ºæ¸¸æˆç»“æŸå¼¹çª—
            if (winnerIndex === 0) {
                elements.gameOverTitle.textContent = 'èƒœåˆ©ï¼';
                elements.gameOverMessage.textContent = 'æ­å–œä½ è·å¾—äº†èƒœåˆ©ï¼';
            } else {
                elements.gameOverTitle.textContent = 'å¤±è´¥ï¼';
                elements.gameOverMessage.textContent = 'å¾ˆé—æ†¾ï¼Œä½ è¾“äº†ï¼';
            }
            
            elements.gameOverModal.classList.add('active');
        }

        // ä¿å­˜è®¾ç½®
        function saveSettings() {
            // è·å–éš¾åº¦è®¾ç½®
            const difficulty = document.querySelector('input[name="difficulty"]:checked').value;
            gameState.difficulty = difficulty;
            
            // æ›´æ–°éš¾åº¦æ˜¾ç¤º
            elements.currentDifficulty.textContent = {
                'easy': 'ç®€å•',
                'medium': 'ä¸­ç­‰',
                'hard': 'å›°éš¾'
            }[difficulty];
            
            // å…³é—­è®¾ç½®å¼¹çª—
            elements.settingsModal.classList.remove('active');
        }

        // æ›´æ–°æ¸¸æˆçŠ¶æ€æç¤º
        function updateGameStatus(message) {
            elements.gameStatus.textContent = message;
        }

        // è·å–ç©å®¶åç§°
        function getPlayerName(playerIndex) {
            switch (playerIndex) {
                case 0: return 'ç©å®¶';
                case 1: return 'å†œæ°‘1';
                case 2: return 'å†œæ°‘2';
                default: return 'æœªçŸ¥';
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOMåŠ è½½å®Œæˆï¼Œå¼€å§‹åˆå§‹åŒ–æ¸¸æˆ');
            initGame();
        });
    </script>
</body>
</html>